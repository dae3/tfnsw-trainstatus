pipeline {
	agent none
	parameters { 
		string(name: 'Environment', defaultValue: 'dev', description: 'target environment name')
	}

	stages {
		stage('build') {
			agent {
				docker {
					image 'node:10-alpine'
					args '-p 3000:3000'
				}
			}
			steps {
				dir('formatAlertForPush') {
					sh 'npm install'
				} 
			}
		}
		stage('deploy') {
			agent {
				dockerfile {
					dir 'deploy-container'
					args '-e AWS_ACCESS_KEY_ID=foo -e AWS_SECRET_ACCESS_KEY=bar -e AWS_DEFAULT_REGION=ap-southeast-2'
				}
			}
			steps {
				dir('formatAlertForPush') {
					sh 'zip add formatAlertForPush.zip *.json *.js node_modules/*'

				}
			}
		}
	}
}
